import smartpy as sp
class RollupVerifier(sp.Contract):
    
    @sp.entry_point
    def verify_rollup_4(self, params):
        sp.set_type(params.input, sp.TBigMap(sp.TInt, sp.TBls12_381_fr))

        vk_h = sp.bls12_381_g2("0x093f5ea81b6b5b16fdfa9879c8e41b345978d5da9157239af5ae004eaf7b1880661981dc44136b3c0d79a600a4f9ef400113cfafcfc63a559db34e2dd9aa58fe3f608841400b9b768c777293fd5d6815f26d1c1edce7213f486a53642399702d0b8b382c51d72ba00419d9a61d93fc31c500df8b261d12001b52079071201e317e11b71403ad49aacc2bf99c9ad2538c0faa6470febb98de5811a74e8e9b4083480316932681e69a2e5eb2597a5227ce243c8729b43fd2e0eb4488db18922bae")
        vk_g_alpha = sp.bls12_381_g1("0x02804d44b928719a196d2480ba900334f5ff740ae83987c0b0c98bea8cbf8ea4a86e6749b9a714a11c963e6ec03bf384001853c18ef97ffe6e2ce2cf728e5854b970cbc42be9b190a5f3ac49ec116bcf7e79db30e3de6cbeb9d3d6979c42a284")
        vk_h_beta = sp.bls12_381_g2("0x19111d1f124fdcebab9b69bc8831ba359efd572b697493f33ee4ce624d08523eae538a657537913f91fb91865f67277f13fb726af8b6f231ec6d23eee81657dd6788837bf373d150b6709aa6191549a3d0101f1b7b739b1e8d7b8ce1aeaf9c3008d6716c58b41a75d7f225355bbb5034d5289a9fee46bc0adf674a51b63caf01f43c377679dec4e7d9866eeeaae9b90f001bf549a0ab199fcea883aed86c796d96d1cb8344bc3cde0279475a2edf247ebad372847a181b6e11374c3478292bb0")
        vk_g_gamma = sp.bls12_381_g1("0x1482c5a0eba460dce7ef7d31f8969efc5a96ac23f2a467a5fa68f840782a010f4d80ca779fa3059e149e9480ac391c55195fc6e3dd753d619f6e027d7fdda92d1299b84095ee666de0f2b4fc685e0ea3c536c29f0c1b21959f3f78e48f0e3e92")
        vk_h_gamma = sp.bls12_381_g2("0x093f5ea81b6b5b16fdfa9879c8e41b345978d5da9157239af5ae004eaf7b1880661981dc44136b3c0d79a600a4f9ef400113cfafcfc63a559db34e2dd9aa58fe3f608841400b9b768c777293fd5d6815f26d1c1edce7213f486a53642399702d0b8b382c51d72ba00419d9a61d93fc31c500df8b261d12001b52079071201e317e11b71403ad49aacc2bf99c9ad2538c0faa6470febb98de5811a74e8e9b4083480316932681e69a2e5eb2597a5227ce243c8729b43fd2e0eb4488db18922bae")
        vk_query_not_local = {
			0: sp.bls12_381_g1("0x01b0b40e5f208c19b8879e8196b4a4bee6b8b46a64905c0523d00bee8e059af445dd8dd504e2f50bd2302c0fad76792312c934c49931b682d2aca902a6a4ec7ee339ce0732ccd9f29b9134f50b2b5e73886301493c643450bd8efbe83f0fc18b"),
			1: sp.bls12_381_g1("0x0dd69040cac2d10990817ae8353513034df401243f9d79d8d95b9c9fe256840aa9feefa657a20ad6447cb7d10d2b46ee18acdacd69c9148c371e01a05fed21c3a2db57fe9dfc24ca98e6b3fdee15a69a6afd6a6d13ce72d0e6250fbe588243e2"),
			2: sp.bls12_381_g1("0x13c912f9090499443d4bc4acd72e3fd6962403c204c338bdd2d785576079ae6fe677d26ae56a6c3141b70f8942c1b179039ab2ca5e0118e7ff67c1dbca362aaf7d00f6b030cb451a5d30ac2c8be9c6a26695037c00ab20b5cb8eed1e932be906"),
			3: sp.bls12_381_g1("0x02849ef7ba6fe12e651d67ce044dd83c676e396da7260b09fd1c53043c912a51ea0b1e74e98b8d4bf4708891f7d0c549178d947d5caf9278e6ed51e98194b3d0ff0ed8e298c15bc8715a6560769fc29b10e15ac570edcb06590c05bc03895f79"),
			4: sp.bls12_381_g1("0x039de3d18c82e2526793b862319e953192818ad454f5d36b4deed540957f71e96233dd9d8a64710f60c8c7c37a055c8102aaa4c0a204cae0627f13876a3277836cb15e495cf4421b0209c884e33c6efd2e19e9309b3ab83947ff7a2722589e3a"),
			5: sp.bls12_381_g1("0x03cafe6b4ff168e8ae65802983d42a129fa76e38090a4980879dd42f822a3eb54d24793887e6862d65136a18abeb8d431015a10631e1c89907e26c59807681a21209f48217c1314863c77a1663ce10f52312f51a716a20722d92502b62ee556f"),
			6: sp.bls12_381_g1("0x1499c363d475e3dc4de23fbb416bc8dbe381694a599d94369bdd8803c58c3c9469d9b3018a2e0cf6471954ebc9f847bc123eac14ac126a3448502f8cb3d839a445e51bed6b54d5034671d81adf80db7bc011fab285f14ba441b5ff8db399c103"),
			7: sp.bls12_381_g1("0x120280eac170d6f019e7b592e717e11370ad481912768dec689a0600204dae086bdbb7dac003f36baa4bb6a5776e421a11bcde45d82721381b8e7c9df1921429304f5fb5039d6fe52bf867ea4f9fa6960312668e6bbe16e9f48664836535c2e5"),
			8: sp.bls12_381_g1("0x1320e2a2318adecf882cceef22084773171fc0d02b06feb7ce35c282f8fc33140b142b3a4e844adcf688eee00146347f0868fe7b41124363c6ab69f47fa0b1b39c2fff85c7cf3d7f0a6efdf4793bafe9716a6de09d59e835f0186d618fa1f485"),
			9: sp.bls12_381_g1("0x07b4c39d8f27ce12b1a3221817b1d5891059bfa79e54120758667722df8da907ad1c6794bddb2eca3abebaddecf18b6d160929bc103aed87d873f4aef39e05837aa85132da93f2642ffb42f85dcb9ded8362afbfc74df08a6b745d8187db4dde"),
			10: sp.bls12_381_g1("0x19ebda5eb8e6e319951dc0f61f97259fa80b80aa7c09223a81a0efec68038471f7f3fb787d90bd3bff687ab7344fd1dd007d1009a7c232cf91e5e38a18c16807fd54f94930671ff6815afaf91f269d32fa564c13395801d19418795cdd031703"),
			11: sp.bls12_381_g1("0x106b29c8d51aeb5feaa4878f1c2e0f456add414ecd4163a0c8468fed1d6a5ea5f2b412b6e46296637214bebb0933906900a31ce38b17d9281586f1ef10df3ce8326b9607c56061a89f68b485bae047eeb5842f10e683b27a386d4793dc3840c6"),
			12: sp.bls12_381_g1("0x1762670987ea7822e312842fdbb5d5b2f32301da362679eec03922996daf7dc455018763084085587d2570166bff8ced140056dbd9e8e8c97a5a90af74ad2f493bdd53fec617d05faeb98a31b24fe25fe731e6d91a9afcfd928040d155e8c426"),
			13: sp.bls12_381_g1("0x02d24b27a864481daf08ef2126a48f26fc8970c0ca7b61b7034d75e02ceb9d9d26537bd89e3262a2a63b8a32c93453901768ffd46b55dc4b781f53269677e8eaef745949f0ff35aebcb34747b2a49d3877c7825cced74d658c513fb53c496d6a"),
			14: sp.bls12_381_g1("0x11a448fe020447f70409c09cdefc3ffa4dbc1f30850f3403acd64417c52145ac39aa1dcee096581ab9976e0f4f5ed6ef09fa2e6199930486f017d74331685ca3e2799b8d5f13a7f4358fb88ffd1cb0c0b1d45e9d636005895809561bad447fec"),
			15: sp.bls12_381_g1("0x0e7accf2be10ddc47c09d77efa30c59395f63732459f25aa8719f09c7c614bc26c2861b2c98ea069d728c64797239409085414e5e0aa3eec895c1750173e289eba5e6f54a773b4af1cca2d2f27f270c1ee3d2d0cea9e20d7e4c26879bb49f429"),
			16: sp.bls12_381_g1("0x190a1ad9c04fbbfbd57f0b92d9fac08ccbdc59eb70098be6ff65c7f138de04f18485b388f0472436b3ac94b3c4ea0d3c12a89c25abe59d793d39f2b2adec6c5b78c3142dbd7311e5c53bbd3d3aac0fdb99a6a888c19a458348e69611e4984b15"),
			17: sp.bls12_381_g1("0x05512f45434b0d6ecf47bf7afea394273622bd9407682cfda50af3687737a071a1e5c6979ce3ef1a9c4bff5731171ed21790d08143463f893687519d31080753b07ee3ac583de087e66695700091398217030360683774359cb5f7a9f25df876"),
			18: sp.bls12_381_g1("0x0d15087dba422886ec26754fe07835e28be59e71bda472ab5c516cde3553275f280863e643769ce1e2a92071ef51d8b8059c48de06af1f7f4b83d62bd449fa2e4da203fe98093507c9241933a4985f913c178eaef2da33be85b9233b0cb6a03d"),
			19: sp.bls12_381_g1("0x0783ecefa49045166b487b0d957da28b5eefad37af46efbe27917c5a2aab6067cd48a3f12187ad98df09d1bfc40cab2718da50fb5276a45df83530f6b9695557a3e34ae831455dc302507f53aa36ce2f5f47eb6b697a1e3341f658141eec1019"),
			20: sp.bls12_381_g1("0x14b7285e28bbaac52d0b002792c6b5bd00de993240c922d506299b437e440db78fa8dc502d3af3272e3db2af5b5108bb0b3e63673e279121467856f307407ab2acdddb7524bdd2ebf78d20b66ba8ef9c1c957e32ef530fd6f9efa62cafd7ccde"),
			21: sp.bls12_381_g1("0x105dd52f88864e0816f6c92ae9b7f1c7f206634547a73af2484636534ac10b5ddb13b5cb1bf303ce498706204c6043d101aac566692172d56652598b2828738120cc34a573dc17e69c9bf2cda1ca9a53886eb47b4e6bfed27b5ff17283630488"),
			22: sp.bls12_381_g1("0x110f84975cf0b4b7f220dab7c1a87f6291a56bf93652cd5efd5c5e64373742f8167ddb16c6dc883813a9aca9d3ebadde0d6544f0e7b6231a731a3398b401ab67aed9ffad3b8a96ec4c4aab2ae5b06c578e41eacbebf3deb64989105a81b42cf6"),
			23: sp.bls12_381_g1("0x0e12a86559f4856874188e616c326fbf01f5999f2cbc49c5f18101af743cb42cae13fb882be1af45e03ca719417cb69005264b7f4fa399c90b2d0232def48b54939d8405a20bb171e38611fa47dfd1dc7d1579d3bc8abcbe83154117f82d81f4"),
			24: sp.bls12_381_g1("0x18fab016fbbfb8e772d340cb5d90fce479ec7536e7035e3913ca178678de14e1f8a103955cc65fb88b35568a48b9124f13c8dd9cc7101f28840d9236b4e0852d04e1070e7e80dccd302035581773479a3d8be71e0a78a4eb41289421d02a4fce"),
			25: sp.bls12_381_g1("0x110ec541768ced813db37b02a289963845b572f108ae0e0bcd0c93aa9fee45aed6877e21c96c8f1a9ad681f40a864f280f834f1161c0f022b14231dc8a53c5fe3ce258dffb3e00aef0a33bee40fddc1bfaab07ff717ad1c3ab5ecfe636a8de7c"),
			26: sp.bls12_381_g1("0x0a336e1bae638f1ddb80e77348c00777599270b9d75d5d7ef5bbed7164197134bb5bc2f13bbbd8bd308839cdc166cb330c60dd59734f96d39c7bb4d2ec2954c783ef1711af06affdc32c360453d43314666108d646fe866cc846107d3ba19d85"),
			27: sp.bls12_381_g1("0x146afa6cb8ff74505565fcb838db0efd71331383acecba85a005b9bf9c9d300f1b4a939744dd88fc1c5bff7df19b3df012cc3ac2bd7cd8d2c9d4e927e6e72cae493a0f4f15188c511f81ecb0ec93c04fdb1141f22778030fc1c1f3a72f4fa994"),
			28: sp.bls12_381_g1("0x17db9b4029d8e8d74b1f2958cf6bcb03f686d9c9b2891915930f93a2ab37a501373a0d0b55f50b3dc66a72f06b2915a90ab4120043f9a6cb931e7cc331c6d6a9b251568b2cc5e5856172d0bfd12788ab46bf1d9de52d8a6bf79c552158e980e0"),
			29: sp.bls12_381_g1("0x170f431203b6be9c1f54c1b1b080e925028bdc5a38ecb3f614b4dff3db237d9b4910a030eb6449dd7e76090396bf278f0d4700b9e869e6eb4ba83b964c137f2be5e26e046bb461fa9778db93ebff6c266c47910160cc9938ddb25d2f78b680e1"),
			30: sp.bls12_381_g1("0x1721e2644d91796e16bbe5efddf1778fff56863c74ea7cd026a5a4cfc3a10dd74f5aa389b1abbcf77ab12e5f904dbda51400c3f4b35254ab87f9c260bc7b781426c06e1a10709abb730940f2efb26e3599e6d2da8375d82519e3f3c075df63e5"),
			31: sp.bls12_381_g1("0x02b5c05d2ff4f76be5df93a01bc0d92710cfcba01023297c8af4881bcf5f24c81130f8995feacba39ef2b7fd15eddfb00ec29eb7237f79ff3fe8939deb70fbb620b28a8137f26f9b756325fe81f863706ae55857b51aadcc65e8aa8bb6db17d5"),
			32: sp.bls12_381_g1("0x0201ef1f8cc45e42f9627d943a5f0d7e8d5664750740cfd1f4a22c67a6ba85e518accfdfa9f55cd26db31bca1267ed580b8e89d67caea61cc5c0153b4b8cbd3b5ea253593693f334562838a12eea5580080bf4278127a054fbf2e3d3b436b555"),
			33: sp.bls12_381_g1("0x00ad5873b84313a15ae7ac130bc7bf9156d6424fed6211566b9acdd1f4d7c67afb960a8952b0ceea351881b71538aa890c949cb2dc8c3f3dc802d9ff28de2dec84c37ea7aa3e62d7182d869a51efd86c14a7bfade2efb86eb9cc036f7e309ffd"),
			34: sp.bls12_381_g1("0x02e5c28110dde978f7cead58ad2698c70548fcc32fd634dbef14085c8da773da6340cc243f191632d81192b1a2e9097f0679575b14e6adbd1adc526065daeebd135a320a6b2d98961eae7f4582191f68bdaeddcd5e8040d9bd1a02b69476bbaf"),
			35: sp.bls12_381_g1("0x0cd93450906f9a7389c44eb22b6ff46ffcb2f7944694c323be4b315363ec623ccfe88dfc1ee9c6dfa2743b70d7782bb8163324f7c7b9f4f6bb2d09d5afbe1a2da17ba2f63d208d43b4c663e0fbcd789c09bc982d14f67f59f48984147105333b"),
			36: sp.bls12_381_g1("0x0f779bc590144e80b0b51275865daa90eddae34603cfc67f45c7f36e25043075f8f470b8b36ccdba24b895505acfc4870bb6297b419425097421d1b89976b09b4fba316ffb670051004da8edff944566944cdf93ed8e0a47673d5b5771293897"),
			37: sp.bls12_381_g1("0x0273278d08029c4a7713eda148c1065d6b377a43aa954c71c8362d88010619da69c29794cd0becaf8115171958c344d313622968f7fbe1a4da6782ccecbeb143fe3822374ae37ebf87963deabb545375971a62c2699215c016b06a7a1d020859"),
			38: sp.bls12_381_g1("0x0b03a71dff5ef31054b60bc2217c1b04f8a574564a3aa22210ef82dc7ce8eeab9bad3ec8f0d00d12482661021827577108efa8b0d38714e337d97696509e8051e51be6dc92c16f9ca9511d924f46b43121f042d695bada84cb7f1200e9b1107e"),
			39: sp.bls12_381_g1("0x0449481309f06100bf03688ac0da1362372980eda1c4d154b4725d7860f082a5269a8c8e4afb8a871c40e6872cfaaf330af279190484667e3c4b97591451748872a13d36644453d62bc63a793ccbbbd71491a2e7d199e1f04ca1d391c7de412a"),
			40: sp.bls12_381_g1("0x0fd6a265b982b0836aba8ae3b5bdc7742253d066fa991c85c461ff07a1bcde716f901eee557c0f36900159217dadf92e134d8cf16d8f9f9d0998a397bad0a340c7a0c109e69083668a5f524bc3713e49aed41d76dd25c7d3db7b61a21c0af78c"),
			41: sp.bls12_381_g1("0x110f4ffd2635e96ef5eb1a3ee3f3b1221906ad7a9fdddcec548bd3146d949d4356321fcfb3de04b41c71eafdf446f38d062fa703b95a3306cf25d1708692e1198ad6f2e89b5b6e77eea7173755cd38589aa675db38a9d41151375e875d7d4e59"),
			42: sp.bls12_381_g1("0x07ddbfa5a93938456aab05221a43f8a3dd396b802a6b96863b8542f85c561b7b16acdb2c4a66f1bc158ae4a23bc9f10c0bb49a4385070b6d88d5af6ae7bf49b74f9894098957d36741eae59d76fa9fd29324739370a37b533986b915a218952f"),
			43: sp.bls12_381_g1("0x0ab98b45815e0abebe4327fb2a8ff3b8f2188df352bc81a501a1097bbea32ccdf156aafb6e0e3c899714d341bfe9451c0a901392e9c46c54307438e3af43989c3002ab7498ce927b18ad0cb292e0bac29e9da5a3cdb934112fb7eae805bce438"),
			44: sp.bls12_381_g1("0x18bacb23cf42e1f73d44b0fb82740f96fc0403a8ff23dde39e78206be7b16f2a91363204a34dd88991abc57f5bc1f3931028822ab7bc854d0cbda9b22a3406af33607bcc5038e98b5a1fdade8a14f465e328a4abbaf6aeab46e450151a934d0f")
		}
        
        vk_query = sp.local('vk_query', vk_query_not_local)

        vk_x_not_local  = sp.mul(vk_query.value[1], params.input[0]) 
        vk_x = sp.local('vk_x', vk_x_not_local)
        
        # sp.range(x, y) goes from x (inclusive) to y (exclusive)
        sp.for i in sp.range(1, sp.len(vk_query.value) - 1):
            vk_x.value = vk_x.value + sp.mul(vk_query.value[ i + 1], params.input[i])

        vk_x.value = vk_x.value + vk_query.value[0]     

        list_pair1 = sp.list([
            sp.pair(vk_g_alpha,vk_h_beta),
            sp.pair(vk_x.value,vk_h_gamma),
            sp.pair(params.proof_c,vk_h),
            sp.pair(- (params.proof_a+vk_g_alpha),params.proof_b+vk_h_beta)
        ])

        list_pair2 = sp.list([
            sp.pair(params.proof_a,vk_h_gamma),
            sp.pair(- vk_g_gamma,params.proof_b)
        ])

        check1 = sp.pairing_check(list_pair1)
        check2 = sp.pairing_check(list_pair2)
        sp.if check1 != True:
            sp.failwith("The proof is not valid, check1 failed")
        sp.if check2 != True:
            sp.failwith("The proof is not valid, check2 failed")

sp.add_compilation_target("RollupVerifier", RollupVerifier())
